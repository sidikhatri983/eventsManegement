<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title id="editTitle" class="translate-btn">Update Event</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2 id="editTitle" class="translate-btn">Update Event</h2>
    <form th:action="@{/events/update/{id}(id=${event.id})}" th:object="${event}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="mb-3">
            <label for="title" class="form-label translate-btn" id="titleLabel">Title:</label>
            <input type="text" th:field="*{title}" id="title" class="form-control" required />
        </div>

        <div class="mb-3">
            <label for="description" class="form-label translate-btn" id="descriptionLabel">Description:</label>
            <textarea th:field="*{description}" id="description" class="form-control" rows="3" required></textarea>
        </div>

        <div class="mb-3">
            <label for="dateStart" class="form-label translate-btn" id="startDateLabel">Start Date:</label>
            <input type="datetime-local" th:field="*{dateStart}" id="dateStart" class="form-control" required />
        </div>

        <div class="mb-3">
            <label for="dateEnd" class="form-label translate-btn" id="endDateLabel">End Date:</label>
            <input type="datetime-local" th:field="*{dateEnd}" id="dateEnd" class="form-control" required />
        </div>

        <div class="mb-3">
            <label for="location" class="form-label translate-btn" id="cityLabel">City:</label>
            <input type="text" th:field="*{location}" id="location" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="locationType" class="form-label translate-btn" id="locationTypeLabel">Location Type:</label>
            <select th:field="*{locationType}" id="locationType" class="form-control" onchange="toggleLocationFields()" required>
                <option value="" class="translate-btn" id="optionChoose">Choose</option>
                <option value="online" class="translate-btn" id="optionOnline">Online</option>
                <option value="present" class="translate-btn" id="optionPresent">Present</option>
            </select>
        </div>

        <div class="mb-3" id="meetingLinkDiv" style="display: none;">
            <label for="meetingLink" class="form-label translate-btn" id="meetingLinkLabel">Meeting Link:</label>
            <input type="url" th:field="*{meetingLink}" id="meetingLink" class="form-control" />
        </div>

        <div class="mb-3" id="gpsDiv" style="display: none;">
            <label for="gpsCoordinates" class="form-label translate-btn" id="gpsLabel">GPS Coordinates:</label>
            <input type="text" th:field="*{gpsLocation}" id="gpsCoordinates" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="visibility" class="form-label translate-btn" id="visibilityLabel">Visibility:</label>
            <select th:field="*{visibility}" id="visibility" class="form-control">
                <option value="PUBLIC" class="translate-btn" id="optionPublic">Public</option>
                <option value="PRIVATE" class="translate-btn" id="optionPrivate">Private</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary translate-btn" id="updateBtn">Update Event</button>
        <a th:href="@{/events}" class="btn btn-secondary translate-btn" id="cancelBtn">Cancel</a>
    </form>
</div>

<script>
    function toggleLocationFields() {
        const type = document.getElementById("locationType").value;
        document.getElementById("meetingLinkDiv").style.display = (type === "online") ? "block" : "none";
        document.getElementById("gpsDiv").style.display = (type === "present") ? "block" : "none";
    }
    window.onload = toggleLocationFields;
</script>

<!-- i18next for auto language -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/21.6.3/i18next.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const selectedLang = localStorage.getItem('lang') || 'en';
        i18next.init({
            lng: selectedLang,
            resources: {
                en: {
                    translation: {
                        editTitle: "Update Event",
                        titleLabel: "Title:",
                        descriptionLabel: "Description:",
                        startDateLabel: "Start Date:",
                        endDateLabel: "End Date:",
                        cityLabel: "City:",
                        locationTypeLabel: "Location Type:",
                        meetingLinkLabel: "Meeting Link:",
                        gpsLabel: "GPS Coordinates:",
                        visibilityLabel: "Visibility:",
                        optionChoose: "Choose",
                        optionOnline: "Online",
                        optionPresent: "Present",
                        optionPublic: "Public",
                        optionPrivate: "Private",
                        updateBtn: "Update Event",
                        cancelBtn: "Cancel"
                    }
                },
                fr: {
                    translation: {
                        editTitle: "Modifier l'événement",
                        titleLabel: "Titre :",
                        descriptionLabel: "Description :",
                        startDateLabel: "Date de début :",
                        endDateLabel: "Date de fin :",
                        cityLabel: "Ville :",
                        locationTypeLabel: "Type de lieu :",
                        meetingLinkLabel: "Lien de réunion :",
                        gpsLabel: "Coordonnées GPS :",
                        visibilityLabel: "Visibilité :",
                        optionChoose: "Choisir",
                        optionOnline: "En ligne",
                        optionPresent: "Présentiel",
                        optionPublic: "Public",
                        optionPrivate: "Privé",
                        updateBtn: "Mettre à jour",
                        cancelBtn: "Annuler"
                    }
                },
                ar: {
                    translation: {
                        editTitle: "تحديث الفعالية",
                        titleLabel: "العنوان:",
                        descriptionLabel: "الوصف:",
                        startDateLabel: "تاريخ البدء:",
                        endDateLabel: "تاريخ الانتهاء:",
                        cityLabel: "المدينة:",
                        locationTypeLabel: "نوع الموقع:",
                        meetingLinkLabel: "رابط الاجتماع:",
                        gpsLabel: "الإحداثيات:",
                        visibilityLabel: "الرؤية:",
                        optionChoose: "اختر",
                        optionOnline: "عبر الإنترنت",
                        optionPresent: "حضوري",
                        optionPublic: "عام",
                        optionPrivate: "خاص",
                        updateBtn: "تحديث الفعالية",
                        cancelBtn: "إلغاء"
                    }
                }
            }
        }, function () {
            document.querySelectorAll('.translate-btn').forEach(function (elem) {
                if (elem.id) {
                    elem.textContent = i18next.t(elem.id);
                }
            });
        });
    });
</script>
</body>
</html>
